!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("config")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("joi")},function(e,t,n){e.exports=n(5)},function(e,t,n){n(1);const r=n(0),i=n(6),o=n(7),s=n(12),a=n(2),d=a();d.use(a.json()),d.use(i()),d.use("/api/users",o),d.use("/api/movies",s),r.connect("mongodb://localhost/kino").then(()=>console.log("connected")).catch(e=>console.error("could not connect",e));const u=process.env.PORT||3020;d.listen(u,()=>console.log(`listening on port ${u}...`))},function(e,t){e.exports=require("cors")},function(e,t,n){const r=n(8),i=n(9),{User:o,validate:s}=n(10),a=(n(0),n(2).Router());a.post("/",async(e,t)=>{const{error:n}=s(e.body);if(n)return t.status(400).send(n.details[0].message);let a=await o.findOne({email:e.body.email});if(a)return t.status(400).send("User already registered.");a=new o(i.pick(e.body,["email","password"]));const d=await r.genSalt(10);a.password=await r.hash(a.password,d),await a.save();const u=a.generateAuthToken();t.send(u)}),e.exports=a},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("lodash")},function(e,t,n){const r=n(0),i=n(3),o=n(1),s=n(11),a=new r.Schema({email:{type:String,unique:!0,minlength:5,maxlength:63,required:!0},registrationDate:{type:Date,default:Date.now},password:{type:String,required:!0,minlength:7,maxlength:1024}});a.methods.generateAuthToken=function(){return s.sign({_id:this._id},o.get("jwtPrivateKey"))};const d=r.model("User",a);t.User=d,t.validate=function(e){const t={email:i.string().min(5).max(63).required().email(),date:i.date(),password:i.string().min(7).max(255).required()};return i.validate(e,t)}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){const{Movie:r,validate:i}=n(13),o=(n(0),n(2).Router());o.get("/",async(e,t)=>{const n=await r.find().sort("title");t.send(n)}),o.post("/",async(e,t)=>{const{error:n}=i(e.body);if(n)return t.status(400).send(n.details[0].message);if(await r.findOne({title:e.body.title}))return t.status(400).send("Movie already added.");const o=new r({title:e.body.title,genre:e.body.genre,director:e.body.director,runningTime:e.body.runningTime,description:e.body.description});await o.save(),t.send(o)}),o.put("/:id",async(e,t)=>{const{error:n}=i(e.body);if(n)return t.status(400).send(n.details[0].message);const o=await r.findByIdAndUpdate(e.params.id,{title:e.body.title,genre:e.body.genre,director:e.body.director,runningTime:e.body.runningTime,description:e.body.description},{new:!0});if(!o)return t.status(404).send("The movie with the given ID was not found.");t.send(o)}),o.delete("/:id",async(e,t)=>{const n=await r.findByIdAndRemove(e.params.id);if(!n)return t.status(404).send("The movie with the given ID was not found.");t.send(n)}),o.get("/:id",async(e,t)=>{const n=await r.findById(e.params.id);if(!n)return t.status(404).send("The movie with the given ID was not found.");t.send(n)}),e.exports=o},function(e,t,n){const r=n(0),i=n(3),o=(n(1),new r.Schema({title:{type:String,unique:!0,minlength:5,maxlength:63,required:!0},director:{type:String,minlength:4,maxlength:63,required:!0},genre:{type:String,required:!0,enum:["DRAMAT","KOMEDIA","MUSICAL","HORROR","ANIMOWANY","FAMILIJNY","SENSACYJNY","PRZYGODOWY"],uppercase:!0},runningTime:{type:Number,required:!0,min:5,max:255},description:{type:String,maxlength:1023}})),s=r.model("Movie",o);t.Movie=s,t.validate=function(e){const t={title:i.string().min(5).max(63).required(),director:i.string().min(4).max(63).required(),genre:i.string().valid(["DRAMAT","KOMEDIA","MUSICAL","HORROR","ANIMOWANY","FAMILIJNY","SENSACYJNY","PRZYGODOWY"]).required(),runningTime:i.number().min(5).required(),description:i.string().max(1023)};return i.validate(e,t)}}]);